<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Upload</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6 flex items-center justify-center">
    <div class="max-w-2xl w-full bg-white rounded-xl shadow-lg p-8">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">File Upload</h1>
            <p class="text-gray-600">Upload your files securely and get a download link</p>
        </div>
        
        <div id="drop-area" class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-blue-500 transition-colors">
            <input type="file" id="file-input" class="hidden" />
            <svg class="w-12 h-12 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0l4 4m-4-4L3 8m14 8v-4a4 4 0 10-8 0v4m6 4H5a2 2 0 01-2-2V8a2 2 0 012-2h6"></path></svg>
            <p class="text-gray-600 mb-2">Drag and drop your file here, or click to select (Max: 20MB)</p>
            <p id="file-name" class="text-sm text-blue-600 font-medium mt-2"></p>
        </div>
        
        <div id="error-message" class="hidden mt-4 p-4 bg-red-50 rounded-lg flex items-center gap-2 text-red-700">
            <p></p>
        </div>
        
        <div id="upload-success" class="hidden mt-4 p-4 bg-green-50 rounded-lg">
            <p class="text-green-700 font-medium">File uploaded successfully!</p>
            <div class="flex items-center gap-2 bg-white p-3 rounded border border-green-200">
                <a id="download-link" href="#" class="text-green-600 hover:text-green-700 break-all" target="_blank"></a>
            </div>
        </div>
        
        <button id="upload-btn" class="mt-6 w-full py-3 px-4 rounded-lg font-medium bg-blue-600 text-white hover:bg-blue-700 flex items-center justify-center gap-2">
            Upload File
        </button>
    </div>
    
    <script>
        const fileInput = document.getElementById('file-input');
        const dropArea = document.getElementById('drop-area');
        const uploadBtn = document.getElementById('upload-btn');
        const errorMessage = document.getElementById('error-message');
        const uploadSuccess = document.getElementById('upload-success');
        const downloadLink = document.getElementById('download-link');
        const fileNameDisplay = document.getElementById('file-name');
        
        let file = null;
        const MAX_FILE_SIZE = 20 * 1024 * 1024;
        
        dropArea.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileSelect);
        dropArea.addEventListener('dragover', (e) => { e.preventDefault(); });
        dropArea.addEventListener('drop', handleFileDrop);
        uploadBtn.addEventListener('click', handleUpload);
        
        function handleFileSelect(event) {
            file = event.target.files[0];
            validateFile();
        }
        
        function handleFileDrop(event) {
            event.preventDefault();
            file = event.dataTransfer.files[0];
            validateFile();
        }
        
        function validateFile() {
            if (file && file.size > MAX_FILE_SIZE) {
                errorMessage.classList.remove('hidden');
                errorMessage.querySelector('p').innerText = 'File size exceeds 20MB limit';
                file = null;
                fileNameDisplay.innerText = '';
            } else {
                errorMessage.classList.add('hidden');
                fileNameDisplay.innerText = file ? `Selected: ${file.name}` : '';
            }
        }
        
        function handleUpload() {
            if (!file) {
                errorMessage.classList.remove('hidden');
                errorMessage.querySelector('p').innerText = 'Please select a file first';
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            
            fetch('https://upfiles.autsc.my.id/api/file', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.download) {
                    uploadSuccess.classList.remove('hidden');
                    downloadLink.href = data.download;
                    downloadLink.innerText = data.download;
                    file = null;
                    fileNameDisplay.innerText = '';
                    fileInput.value = '';
                } else {
                    errorMessage.classList.remove('hidden');
                    errorMessage.querySelector('p').innerText = 'Upload failed';
                }
            })
            .catch(() => {
                errorMessage.classList.remove('hidden');
                errorMessage.querySelector('p').innerText = 'Upload failed. Please try again.';
            });
        }
    </script>
</body>
</html>
